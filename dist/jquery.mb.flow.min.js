/*jquery.mb.flow 20-04-2021
 _ jquery.mb.components 
 _ email: matbicoc@gmail.com 
 _ Copyright (c) 2001-2021. Matteo Bicocchi (Pupunzi); 
 _ blog: http://pupunzi.open-lab.com 
 _ Open Lab s.r.l., Florence - Italy 
 */

import{FlowApp}from"../Classes/FlowApp.js";import{UI}from"../Classes/UI.js";import{ContextualMenu}from"../Classes/ContextualMenu.js";import{Util}from"../Classes/Util.js";!function(o){o(function(){window.flowApp=new FlowApp;var e=o.mbStorage.get("lastFlow");null!=e?flowApp.load(e):o.flow.addFlow(),o.flow.init(),window.board_list_element_menu=new ContextualMenu(".board-list-element-menu",o.flow.contextualMenu.boardListelement),window.flows_menu=new ContextualMenu(".flows-menu",o.flow.contextualMenu.flows,!0),window.boards_groups=new ContextualMenu(".boards-group-menu",o.flow.contextualMenu.BoardsGroups,!0)}),o.flow={init:function(){o("body").on("keydown","[contenteditable]",e=>{13===e.keyCode&&(e.preventDefault(),o(e.target).blur())})},contextualMenu:{boardListelement:[{name:"Rename",fn:function(e){e=o(e).parent().data("board-id");o.flow.editBoardName(e)}},{name:"Duplicate",fn:function(e){e=o(e).parent().data("board-id");o.flow.duplicateBoard(e)}},{},{name:"Delete",fn:function(e){let t=o(e).parent().data("board-id");UI.dialogue("Delete Board","Are you sure you want to delete<br><b>"+o(e).parent().find(".name").text()+"</b>?",null,null,null,"Yes","Cancel",()=>{o.flow.deleteBoard(t),flowApp.save()})}},{},{name:"Export",fn:function(e){var t=o(e).parent().data("board-id"),e=o(e).parent().find(".name").text();console.debug("Export "+t+"  -  "+e)}}],flows:[{name:"Rename",fn:function(e){var t=o(e).parent().data("flow-id");console.debug(e,t),o.flow.editFlowName(t)}},{name:"Duplicate",fn:function(e){console.log("Duplicate",o(e).parent().data("flow-id"))}},{},{name:"Delete",fn:function(e){o(e).parent().data("flow-id");UI.dialogue("Delete Board","Are you sure you want to delete<br><b>"+o(e).parent().find(".name").text()+"</b>?",null,null,null,"Yes","Cancel",()=>{o.flow.deleteBoard(boardId),flowApp.save()})}},{},{name:"Export",fn:function(e){var t=o(e).parent().data("flow-id"),e=o(e).parent().find(".name").text();console.debug("Export "+t+"  -  "+e)}}],BoardsGroups:function(){let r=[],e=flowApp.flow.getBoardsGroupsList();return e.forEach(t=>{var e={name:t,fn:function(e){console.debug("filter by group:"+t),o.flow.showBoardsByGroup(t)}};r.push(e)}),r.push({}),r.push({name:"Show All",fn:function(e){console.debug("filter by group: Show All"),o.flow.showBoardsByGroup("all")}}),r.push({name:"Add Group",fn:function(e){UI.dialogue("Add new Group",null,"groupName","Group name",null,"Add","Cancel",e=>{let t=flowApp.flow.addBoard();t._group=e,o.flow.showBoardsByGroup(e)}),console.debug("Add Group")}}),r}},addFlow:function(){UI.dialogue("Add a new Flow",null,"flowName","Flow Name",null,"Add","Cancel",function(e){flowApp.addFlow(e),o.mbStorage.set("lastFlow",flowApp.flow.id),flowApp.save(flowApp.flow.id)})},openFlow:function(){},addBoard:function(){UI.dialogue("Add a new Board",null,"boardName","Board Name",null,"Add","Cancel",function(e){flowApp.flow.addBoard(e)})},duplicateBoard:function(e){flowApp.flow.duplicateBoard(e)},showBoardsByGroup:function(e){o(flowApp.ui.placeholders.boardList).find("li").hide(),("all"!=e?o(flowApp.ui.placeholders.boardList).find('[data-board-group="'+e+'"]'):o(flowApp.ui.placeholders.boardList).find("li")).show()},updateFlowName:function(e){flowApp.flow.updateName(e)},editFlowName:function(e){let t=o(flowApp.ui.placeholders.flowName).find("h1");t.attr({contentEditable:!0}),t.focus(),Util.selectElementContents(t.get(0)),t.one("blur",()=>{o.flow.updateFlowName(t.text()),t.attr({contentEditable:!1})})},editBoardName:function(t){let r=o(flowApp.ui.placeholders.boardList).find("#board_"+t+" .name");r.attr({contentEditable:!0}),r.focus(),Util.selectElementContents(r.get(0)),r.one("blur",()=>{let e=flowApp.flow.getBoardById(t);e._name=r.text(),flowApp.save(flowApp.flow.id),flowApp.drawer.drawBoardList()})},deleteBoard:function(e){flowApp.flow.deleteBoard(e),flowApp.drawer.drawBoardList(),flowApp.save(flowApp.flow.id)}},Array.prototype.delete=function(e){for(var t=0;t<this.length;t++)this[t]===e&&(this.splice(t,1),t--)}}(jQuery,document),function(u,n,s){var r={drag:!0,drop:!0,exclude:"",nested:!0,vertical:!0},o={afterMove:function(e,t,r){},containerPath:"",containerSelector:"ol, ul",distance:0,delay:0,handle:"",itemPath:"",itemSelector:"li",bodyClass:"dragging",draggedClass:"dragged",isValidTarget:function(e,t){return!0},onCancel:function(e,t,r,o){},onDrag:function(e,t,r,o){e.css(t)},onDragStart:function(e,t,r,o){e.css({height:e.outerHeight(),width:e.outerWidth()}),e.addClass(t.group.options.draggedClass),u("body").addClass(t.group.options.bodyClass)},onDrop:function(e,t,r,o){e.removeClass(t.group.options.draggedClass).removeAttr("style"),u("body").removeClass(t.group.options.bodyClass)},onMousedown:function(e,t,r){if(!r.target.nodeName.match(/^(input|select|textarea)$/i))return r.preventDefault(),!0},placeholderClass:"placeholder",placeholder:'<li class="placeholder"></li>',pullPlaceholder:!0,serialize:function(e,t,r){e=u.extend({},e.data());return r?[t]:(t[0]&&(e.children=t),delete e.subContainers,delete e.sortable,e)},tolerance:0},t={},i=0,f={left:0,top:0,bottom:0,right:0},a={start:"touchstart.sortable mousedown.sortable",drop:"touchend.sortable touchcancel.sortable mouseup.sortable",drag:"touchmove.sortable mousemove.sortable",scroll:"scroll.sortable"},l="subContainers";function d(e,t){return Math.max(0,e[0]-t[0],t[0]-e[1])+Math.max(0,e[2]-t[1],t[1]-e[3])}function e(e,t,r,o){var n=e.length,i=o?"offset":"position";for(r=r||0;n--;){var s=e[n].el||u(e[n]),a=s[i]();a.left+=parseInt(s.css("margin-left"),10),a.top+=parseInt(s.css("margin-top"),10),t[n]=[a.left-r,a.left+s.outerWidth()+r,a.top-r,a.top+s.outerHeight()+r]}}function p(e,t){t=t.offset();return{left:e.left-t.left,top:e.top-t.top}}function c(e,t,r){t=[t.left,t.top],r=r&&[r.left,r.top];for(var o,n=e.length,i=[];n--;)o=e[n],i[n]=[n,d(o,t),r&&d(o,r)];return i=i.sort(function(e,t){return t[1]-e[1]||t[2]-e[2]||t[0]-e[0]})}function h(e){this.options=u.extend({},o,e),this.containers=[],this.options.rootGroup||(this.scrollProxy=u.proxy(this.scroll,this),this.dragProxy=u.proxy(this.drag,this),this.dropProxy=u.proxy(this.drop,this),this.placeholder=u(this.options.placeholder),e.isValidTarget||(this.options.isValidTarget=s))}function m(e,t){this.el=e,this.options=u.extend({},r,t),this.group=h.get(this.options),this.rootGroup=this.options.rootGroup||this.group,this.handle=this.rootGroup.options.handle||this.rootGroup.options.itemSelector;t=this.rootGroup.options.itemPath;this.target=t?this.el.find(t):this.el,this.target.on(a.start,this.handle,u.proxy(this.dragInit,this)),this.options.drop&&this.group.containers.push(this)}h.get=function(e){return t[e.group]||(e.group===s&&(e.group=i++),t[e.group]=new h(e)),t[e.group]},h.prototype={dragInit:function(e,t){this.$document=u(t.el[0].ownerDocument);var r=u(e.target).closest(this.options.itemSelector);r.length&&(this.item=r,this.itemContainer=t,!this.item.is(this.options.exclude)&&this.options.onMousedown(this.item,o.onMousedown,e)&&(this.setPointer(e),this.toggleListeners("on"),this.setupDelayTimer(),this.dragInitDone=!0))},drag:function(e){if(!this.dragging){if(!this.distanceMet(e)||!this.delayMet)return;this.options.onDragStart(this.item,this.itemContainer,o.onDragStart,e),this.item.before(this.placeholder),this.dragging=!0}this.setPointer(e),this.options.onDrag(this.item,p(this.pointer,this.item.offsetParent()),o.onDrag,e);var t=this.getPointer(e),r=this.sameResultBox,e=this.options.tolerance;(!r||r.top-e>t.top||r.bottom+e<t.top||r.left-e>t.left||r.right+e<t.left)&&(this.searchValidTarget()||(this.placeholder.detach(),this.lastAppendedItem=s))},drop:function(e){this.toggleListeners("off"),this.dragInitDone=!1,this.dragging&&(this.placeholder.closest("html")[0]?this.placeholder.before(this.item).detach():this.options.onCancel(this.item,this.itemContainer,o.onCancel,e),this.options.onDrop(this.item,this.getContainer(this.item),o.onDrop,e),this.clearDimensions(),this.clearOffsetParent(),this.lastAppendedItem=this.sameResultBox=s,this.dragging=!1)},searchValidTarget:function(e,t){e||(e=this.relativePointer||this.pointer,t=this.lastRelativePointer||this.lastPointer);for(var r=c(this.getContainerDimensions(),e,t),o=r.length;o--;){var n=r[o][0];if(!r[o][1]||this.options.pullPlaceholder){var i=this.containers[n];if(!i.disabled)if(this.$getOffsetParent()||(e=p(e,n=i.getItemOffsetParent()),t=p(t,n)),i.searchValidTarget(e,t))return!0}}this.sameResultBox&&(this.sameResultBox=s)},movePlaceholder:function(e,t,r,o){var n=this.lastAppendedItem;!o&&n&&n[0]===t[0]||(t[r](this.placeholder),this.lastAppendedItem=t,this.sameResultBox=o,this.options.afterMove(this.placeholder,e,t))},getContainerDimensions:function(){return this.containerDimensions||e(this.containers,this.containerDimensions=[],this.options.tolerance,!this.$getOffsetParent()),this.containerDimensions},getContainer:function(e){return e.closest(this.options.containerSelector).data(n)},$getOffsetParent:function(){if(this.offsetParent===s){var e=this.containers.length-1,t=this.containers[e].getItemOffsetParent();if(!this.options.rootGroup)for(;e--;)if(t[0]!=this.containers[e].getItemOffsetParent()[0]){t=!1;break}this.offsetParent=t}return this.offsetParent},setPointer:function(e){var t=this.getPointer(e);this.$getOffsetParent()&&(e=p(t,this.$getOffsetParent()),this.lastRelativePointer=this.relativePointer,this.relativePointer=e),this.lastPointer=this.pointer,this.pointer=t},distanceMet:function(e){e=this.getPointer(e);return Math.max(Math.abs(this.pointer.left-e.left),Math.abs(this.pointer.top-e.top))>=this.options.distance},getPointer:function(e){var t=e.originalEvent||e.originalEvent.touches&&e.originalEvent.touches[0];return{left:e.pageX||t.pageX,top:e.pageY||t.pageY}},setupDelayTimer:function(){var e=this;this.delayMet=!this.options.delay,this.delayMet||(clearTimeout(this._mouseDelayTimer),this._mouseDelayTimer=setTimeout(function(){e.delayMet=!0},this.options.delay))},scroll:function(e){this.clearDimensions(),this.clearOffsetParent()},toggleListeners:function(r){var o=this;u.each(["drag","drop","scroll"],function(e,t){o.$document[r](a[t],o[t+"Proxy"])})},clearOffsetParent:function(){this.offsetParent=s},clearDimensions:function(){this.traverse(function(e){e._clearDimensions()})},traverse:function(e){e(this);for(var t=this.containers.length;t--;)this.containers[t].traverse(e)},_clearDimensions:function(){this.containerDimensions=s},_destroy:function(){t[this.options.group]=s}},m.prototype={dragInit:function(e){var t=this.rootGroup;!this.disabled&&!t.dragInitDone&&this.options.drag&&this.isValidDrag(e)&&t.dragInit(e,this)},isValidDrag:function(e){return 1==e.which||"touchstart"==e.type&&1==e.originalEvent.touches.length},searchValidTarget:function(e,t){var r=c(this.getItemDimensions(),e,t),o=r.length,n=this.rootGroup,i=!n.options.isValidTarget||n.options.isValidTarget(n.item,this);if(!o&&i)return n.movePlaceholder(this,this.target,"append"),!0;for(;o--;){var s=r[o][0],a=r[o][1];if(!a&&this.hasChildGroup(s)){if(this.getContainerGroup(s).searchValidTarget(e,t))return!0}else if(i)return this.movePlaceholder(s,e),!0}},movePlaceholder:function(e,t){var r=u(this.items[e]),o=this.itemDimensions[e],n="after",i=r.outerWidth(),s=r.outerHeight(),a=r.offset(),l={left:a.left,right:a.left+i,top:a.top,bottom:a.top+s};this.options.vertical?(a=(o[2]+o[3])/2,t.top<=a?(n="before",l.bottom-=s/2):l.top+=s/2):(o=(o[0]+o[1])/2,t.left<=o?(n="before",l.right-=i/2):l.left+=i/2),this.hasChildGroup(e)&&(l=f),this.rootGroup.movePlaceholder(this,r,n,l)},getItemDimensions:function(){return this.itemDimensions||(this.items=this.$getChildren(this.el,"item").filter(":not(."+this.group.options.placeholderClass+", ."+this.group.options.draggedClass+")").get(),e(this.items,this.itemDimensions=[],this.options.tolerance)),this.itemDimensions},getItemOffsetParent:function(){var e=this.el,e="relative"===e.css("position")||"absolute"===e.css("position")||"fixed"===e.css("position")?e:e.offsetParent();return e},hasChildGroup:function(e){return this.options.nested&&this.getContainerGroup(e)},getContainerGroup:function(e){var t,r,o=u.data(this.items[e],l);return o===s&&(o=!1,(t=this.$getChildren(this.items[e],"container"))[0]&&(r=u.extend({},this.options,{rootGroup:this.rootGroup,group:i++}),o=t[n](r).data(n).group),u.data(this.items[e],l,o)),o},$getChildren:function(e,t){var r=this.rootGroup.options,o=r[t+"Path"],t=r[t+"Selector"];return e=u(e),(e=o?e.find(o):e).children(t)},_serialize:function(e,t){var r=this,o=this.$getChildren(e,t?"item":"container").not(this.options.exclude).map(function(){return r._serialize(u(this),!t)}).get();return this.rootGroup.options.serialize(e,o,t)},traverse:function(r){u.each(this.items||[],function(e){var t=u.data(this,l);t&&t.traverse(r)}),r(this)},_clearDimensions:function(){this.itemDimensions=s},_destroy:function(){var t=this;this.target.off(a.start,this.handle),this.el.removeData(n),this.options.drop&&(this.group.containers=u.grep(this.group.containers,function(e){return e!=t})),u.each(this.items||[],function(){u.removeData(this,l)})}};var g={enable:function(){this.traverse(function(e){e.disabled=!1})},disable:function(){this.traverse(function(e){e.disabled=!0})},serialize:function(){return this._serialize(this.el,!0)},refresh:function(){this.traverse(function(e){e._clearDimensions()})},destroy:function(){this.traverse(function(e){e._destroy()})}};u.extend(m.prototype,g),u.fn[n]=function(r){var o=Array.prototype.slice.call(arguments,1);return this.map(function(){var e=u(this),t=e.data(n);return t&&g[r]?g[r].apply(t,o)||this:(t||r!==s&&"object"!=typeof r||e.data(n,new m(e,r)),this)})}}(jQuery,(window,"sortable"));var nAgt=navigator.userAgent;function isTouchSupported(){var e=nAgt.msMaxTouchPoints,t="ontouchstart"in document.createElement("div");return!(!e&&!t)}jQuery.browser=jQuery.browser||{},jQuery.browser.mozilla=!1,jQuery.browser.webkit=!1,jQuery.browser.opera=!1,jQuery.browser.safari=!1,jQuery.browser.chrome=!1,jQuery.browser.androidStock=!1,jQuery.browser.msie=!1,jQuery.browser.edge=!1,jQuery.browser.ua=nAgt;var nameOffset,verOffset,ix,start,end,getOS=function(){var e={version:"Unknown version",name:"Unknown OS"};return-1!=navigator.appVersion.indexOf("Win")&&(e.name="Windows"),-1!=navigator.appVersion.indexOf("Mac")&&navigator.appVersion.indexOf("Mobile")<0&&(e.name="Mac"),-1!=navigator.appVersion.indexOf("Linux")&&(e.name="Linux"),/Mac OS X/.test(nAgt)&&!/Mobile/.test(nAgt)&&(e.version=/Mac OS X ([\._\d]+)/.exec(nAgt)[1],e.version=e.version.replace(/_/g,".").substring(0,5)),/Windows/.test(nAgt)&&(e.version="Unknown.Unknown"),/Windows NT 5.1/.test(nAgt)&&(e.version="5.1"),/Windows NT 6.0/.test(nAgt)&&(e.version="6.0"),/Windows NT 6.1/.test(nAgt)&&(e.version="6.1"),/Windows NT 6.2/.test(nAgt)&&(e.version="6.2"),/Windows NT 10.0/.test(nAgt)&&(e.version="10.0"),/Linux/.test(nAgt)&&/Linux/.test(nAgt)&&(e.version="Unknown.Unknown"),e.name=e.name.toLowerCase(),e.major_version="Unknown",e.minor_version="Unknown","Unknown.Unknown"!=e.version&&(e.major_version=parseFloat(e.version.split(".")[0]),e.minor_version=parseFloat(e.version.split(".")[1])),e};function uncamel(e){return e.replace(/([A-Z])/g,function(e){return"-"+e.toLowerCase()})}function setUnit(e,t){return"string"!=typeof e||e.match(/^[\-0-9\.]+jQuery/)?""+e+t:e}function setFilter(e,t,r){var o=uncamel(t),n=jQuery.browser.mozilla?"":jQuery.CSS.sfx;e[n+"filter"]=e[n+"filter"]||"",r=setUnit(r>jQuery.CSS.filters[t].max?jQuery.CSS.filters[t].max:r,jQuery.CSS.filters[t].unit),e[n+"filter"]+=o+"("+r+") ",delete e[t]}jQuery.browser.os=getOS(),jQuery.browser.hasTouch=isTouchSupported(),jQuery.browser.name=navigator.appName,jQuery.browser.fullVersion=""+parseFloat(navigator.appVersion),jQuery.browser.majorVersion=parseInt(navigator.appVersion,10),-1!=(verOffset=nAgt.indexOf("Opera"))?(jQuery.browser.opera=!0,jQuery.browser.name="Opera",jQuery.browser.fullVersion=nAgt.substring(verOffset+6),-1!=(verOffset=nAgt.indexOf("Version"))&&(jQuery.browser.fullVersion=nAgt.substring(verOffset+8))):-1!=(verOffset=nAgt.indexOf("OPR"))?(jQuery.browser.opera=!0,jQuery.browser.name="Opera",jQuery.browser.fullVersion=nAgt.substring(verOffset+4)):-1!=(verOffset=nAgt.indexOf("MSIE"))?(jQuery.browser.msie=!0,jQuery.browser.name="Microsoft Internet Explorer",jQuery.browser.fullVersion=nAgt.substring(verOffset+5)):-1!=nAgt.indexOf("Trident")?(jQuery.browser.msie=!0,jQuery.browser.name="Microsoft Internet Explorer",start=nAgt.indexOf("rv:")+3,jQuery.browser.fullVersion=nAgt.substring(start,end=start+4)):-1!=(verOffset=nAgt.indexOf("Edge"))?(jQuery.browser.edge=!0,jQuery.browser.name="Microsoft Edge",jQuery.browser.fullVersion=nAgt.substring(verOffset+5)):-1!=(verOffset=nAgt.indexOf("Chrome"))?(jQuery.browser.webkit=!0,jQuery.browser.chrome=!0,jQuery.browser.name="Chrome",jQuery.browser.fullVersion=nAgt.substring(verOffset+7)):-1<nAgt.indexOf("mozilla/5.0")&&-1<nAgt.indexOf("android ")&&-1<nAgt.indexOf("applewebkit")&&!(-1<nAgt.indexOf("chrome"))?(verOffset=nAgt.indexOf("Chrome"),jQuery.browser.webkit=!0,jQuery.browser.androidStock=!0,jQuery.browser.name="androidStock",jQuery.browser.fullVersion=nAgt.substring(verOffset+7)):-1!=(verOffset=nAgt.indexOf("Safari"))||-1!=(verOffset=nAgt.indexOf("AppleWebkit"))?(jQuery.browser.webkit=!0,jQuery.browser.safari=!0,jQuery.browser.name="Safari",jQuery.browser.fullVersion=nAgt.substring(verOffset+7),-1!=(verOffset=nAgt.indexOf("Version"))&&(jQuery.browser.fullVersion=nAgt.substring(verOffset+8))):-1!=(verOffset=nAgt.indexOf("Firefox"))?(jQuery.browser.mozilla=!0,jQuery.browser.name="Firefox",jQuery.browser.fullVersion=nAgt.substring(verOffset+8)):(nameOffset=nAgt.lastIndexOf(" ")+1)<(verOffset=nAgt.lastIndexOf("/"))&&(jQuery.browser.name=nAgt.substring(nameOffset,verOffset),jQuery.browser.fullVersion=nAgt.substring(verOffset+1),jQuery.browser.name.toLowerCase()==jQuery.browser.name.toUpperCase()&&(jQuery.browser.name=navigator.appName)),-1!=(ix=jQuery.browser.fullVersion.indexOf(";"))&&(jQuery.browser.fullVersion=jQuery.browser.fullVersion.substring(0,ix)),-1!=(ix=jQuery.browser.fullVersion.indexOf(" "))&&(jQuery.browser.fullVersion=jQuery.browser.fullVersion.substring(0,ix)),jQuery.browser.majorVersion=parseInt(""+jQuery.browser.fullVersion,10),isNaN(jQuery.browser.majorVersion)&&(jQuery.browser.fullVersion=""+parseFloat(navigator.appVersion),jQuery.browser.majorVersion=parseInt(navigator.appVersion,10)),jQuery.browser.version=jQuery.browser.majorVersion,jQuery.browser.android=/Android/i.test(nAgt),jQuery.browser.blackberry=/BlackBerry|BB|PlayBook/i.test(nAgt),jQuery.browser.ios=/iPhone|iPad|iPod|webOS/i.test(nAgt),jQuery.browser.operaMobile=/Opera Mini/i.test(nAgt),jQuery.browser.windowsMobile=/IEMobile|Windows Phone/i.test(nAgt),jQuery.browser.kindle=/Kindle|Silk/i.test(nAgt),jQuery.browser.mobile=jQuery.browser.android||jQuery.browser.blackberry||jQuery.browser.ios||jQuery.browser.windowsMobile||jQuery.browser.operaMobile||jQuery.browser.kindle,jQuery.isMobile=jQuery.browser.mobile,jQuery.isTablet=jQuery.browser.mobile&&765<jQuery(window).width(),jQuery.isAndroidDefault=jQuery.browser.android&&!/chrome/i.test(nAgt),jQuery.mbBrowser=jQuery.browser,jQuery.browser.versionCompare=function(e,t){if("stringstring"!=typeof e+typeof t)return!1;for(var r=e.split("."),o=t.split("."),n=0,i=Math.max(r.length,o.length);n<i;n++){if(r[n]&&!o[n]&&0<parseInt(r[n])||parseInt(r[n])>parseInt(o[n]))return 1;if(o[n]&&!r[n]&&0<parseInt(o[n])||parseInt(r[n])<parseInt(o[n]))return-1}return 0},jQuery.support.CSStransition=function(){var e=(document.body||document.documentElement).style;return void 0!==e.transition||void 0!==e.WebkitTransition||void 0!==e.MozTransition||void 0!==e.MsTransition||void 0!==e.OTransition}(),jQuery.CSS={name:"mb.CSSAnimate",author:"Matteo Bicocchi",version:"2.0.0",transitionEnd:"transitionEnd",sfx:"",filters:{blur:{min:0,max:100,unit:"px"},brightness:{min:0,max:400,unit:"%"},contrast:{min:0,max:400,unit:"%"},grayscale:{min:0,max:100,unit:"%"},hueRotate:{min:0,max:360,unit:"deg"},invert:{min:0,max:100,unit:"%"},saturate:{min:0,max:400,unit:"%"},sepia:{min:0,max:100,unit:"%"}},normalizeCss:function(e){var t,r,o=jQuery.extend(!0,{},e);for(t in jQuery.browser.webkit||jQuery.browser.opera?jQuery.CSS.sfx="-webkit-":jQuery.browser.mozilla?jQuery.CSS.sfx="-moz-":jQuery.browser.msie&&(jQuery.CSS.sfx="-ms-"),jQuery.CSS.sfx="",o)"transform"===t&&(o[jQuery.CSS.sfx+"transform"]=o[t],delete o[t]),"transform-origin"===t&&(o[jQuery.CSS.sfx+"transform-origin"]=e[t],delete o[t]),"filter"!==t||jQuery.browser.mozilla||(o[jQuery.CSS.sfx+"filter"]=e[t],delete o[t]),"blur"===t&&setFilter(o,"blur",e[t]),"brightness"===t&&setFilter(o,"brightness",e[t]),"contrast"===t&&setFilter(o,"contrast",e[t]),"grayscale"===t&&setFilter(o,"grayscale",e[t]),"hueRotate"===t&&setFilter(o,"hueRotate",e[t]),"invert"===t&&setFilter(o,"invert",e[t]),"saturate"===t&&setFilter(o,"saturate",e[t]),"sepia"===t&&setFilter(o,"sepia",e[t]),"x"===t&&(o[r=jQuery.CSS.sfx+"transform"]=o[r]||"",o[r]+=" translateX("+setUnit(e[t],"px")+")",delete o[t]),"y"===t&&(o[r=jQuery.CSS.sfx+"transform"]=o[r]||"",o[r]+=" translateY("+setUnit(e[t],"px")+")",delete o[t]),"z"===t&&(o[r=jQuery.CSS.sfx+"transform"]=o[r]||"",o[r]+=" translateZ("+setUnit(e[t],"px")+")",delete o[t]),"rotate"===t&&(o[r=jQuery.CSS.sfx+"transform"]=o[r]||"",o[r]+=" rotate("+setUnit(e[t],"deg")+")",delete o[t]),"rotateX"===t&&(o[r=jQuery.CSS.sfx+"transform"]=o[r]||"",o[r]+=" rotateX("+setUnit(e[t],"deg")+")",delete o[t]),"rotateY"===t&&(o[r=jQuery.CSS.sfx+"transform"]=o[r]||"",o[r]+=" rotateY("+setUnit(e[t],"deg")+")",delete o[t]),"rotateZ"===t&&(o[r=jQuery.CSS.sfx+"transform"]=o[r]||"",o[r]+=" rotateZ("+setUnit(e[t],"deg")+")",delete o[t]),"scale"===t&&(o[r=jQuery.CSS.sfx+"transform"]=o[r]||"",o[r]+=" scale("+setUnit(e[t],"")+")",delete o[t]),"scaleX"===t&&(o[r=jQuery.CSS.sfx+"transform"]=o[r]||"",o[r]+=" scaleX("+setUnit(e[t],"")+")",delete o[t]),"scaleY"===t&&(o[r=jQuery.CSS.sfx+"transform"]=o[r]||"",o[r]+=" scaleY("+setUnit(e[t],"")+")",delete o[t]),"scaleZ"===t&&(o[r=jQuery.CSS.sfx+"transform"]=o[r]||"",o[r]+=" scaleZ("+setUnit(e[t],"")+")",delete o[t]),"skew"===t&&(o[r=jQuery.CSS.sfx+"transform"]=o[r]||"",o[r]+=" skew("+setUnit(e[t],"deg")+")",delete o[t]),"skewX"===t&&(o[r=jQuery.CSS.sfx+"transform"]=o[r]||"",o[r]+=" skewX("+setUnit(e[t],"deg")+")",delete o[t]),"skewY"===t&&(o[r=jQuery.CSS.sfx+"transform"]=o[r]||"",o[r]+=" skewY("+setUnit(e[t],"deg")+")",delete o[t]),"perspective"===t&&(o[r=jQuery.CSS.sfx+"transform"]=o[r]||"",o[r]+=" perspective("+setUnit(e[t],"px")+")",delete o[t]);return o},getProp:function(e){var t,r=[];for(t in e)r.indexOf(t)<0&&r.push(uncamel(t));return r.join(",")},animate:function(a,l,u,f,d){return this.each(function(){function e(){t.called=!0,t.CSSAIsRunning=!1,r.off(jQuery.CSS.transitionEnd+"."+t.id),clearTimeout(t.timeout),r.css(jQuery.CSS.sfx+"transition",""),"function"==typeof d&&d.apply(t),"function"==typeof t.CSSqueue&&(t.CSSqueue(),t.CSSqueue=null)}var t=this,r=jQuery(this);t.id=t.id||"CSSA_"+(new Date).getTime();var o=o||{type:"noEvent"};if(t.CSSAIsRunning&&t.eventType==o.type&&!jQuery.browser.msie&&jQuery.browser.version<=9)t.CSSqueue=function(){r.CSSAnimate(a,l,u,f,d)};else if(t.CSSqueue=null,t.eventType=o.type,0!==r.length&&a){if(a=jQuery.normalizeCss(a),t.CSSAIsRunning=!0,"function"==typeof l&&(d=l,l=jQuery.fx.speeds._default),"function"==typeof u&&(f=u,u=0),"string"==typeof u&&(d=u,u=0),"function"==typeof f&&(d=f,f="cubic-bezier(0.65,0.03,0.36,0.72)"),"string"==typeof l)for(var n in jQuery.fx.speeds){if(l==n){l=jQuery.fx.speeds[n];break}l=jQuery.fx.speeds._default}if(l=l||jQuery.fx.speeds._default,"string"==typeof d&&(f=d,d=null),jQuery.support.CSStransition){(i={default:"ease",in:"ease-in",out:"ease-out","in-out":"ease-in-out",snap:"cubic-bezier(0,1,.5,1)",easeOutCubic:"cubic-bezier(.215,.61,.355,1)",easeInOutCubic:"cubic-bezier(.645,.045,.355,1)",easeInCirc:"cubic-bezier(.6,.04,.98,.335)",easeOutCirc:"cubic-bezier(.075,.82,.165,1)",easeInOutCirc:"cubic-bezier(.785,.135,.15,.86)",easeInExpo:"cubic-bezier(.95,.05,.795,.035)",easeOutExpo:"cubic-bezier(.19,1,.22,1)",easeInOutExpo:"cubic-bezier(1,0,0,1)",easeInQuad:"cubic-bezier(.55,.085,.68,.53)",easeOutQuad:"cubic-bezier(.25,.46,.45,.94)",easeInOutQuad:"cubic-bezier(.455,.03,.515,.955)",easeInQuart:"cubic-bezier(.895,.03,.685,.22)",easeOutQuart:"cubic-bezier(.165,.84,.44,1)",easeInOutQuart:"cubic-bezier(.77,0,.175,1)",easeInQuint:"cubic-bezier(.755,.05,.855,.06)",easeOutQuint:"cubic-bezier(.23,1,.32,1)",easeInOutQuint:"cubic-bezier(.86,0,.07,1)",easeInSine:"cubic-bezier(.47,0,.745,.715)",easeOutSine:"cubic-bezier(.39,.575,.565,1)",easeInOutSine:"cubic-bezier(.445,.05,.55,.95)",easeInBack:"cubic-bezier(.6,-.28,.735,.045)",easeOutBack:"cubic-bezier(.175, .885,.32,1.275)",easeInOutBack:"cubic-bezier(.68,-.55,.265,1.55)"})[f]&&(f=i[f]),r.off(jQuery.CSS.transitionEnd+"."+t.id);var i=jQuery.CSS.getProp(a),s={};jQuery.extend(s,a),s[jQuery.CSS.sfx+"transition-property"]=i,s[jQuery.CSS.sfx+"transition-duration"]=l+"ms",s[jQuery.CSS.sfx+"transition-delay"]=u+"ms",s[jQuery.CSS.sfx+"transition-timing-function"]=f,setTimeout(function(){r.one(jQuery.CSS.transitionEnd+"."+t.id,e),r.css(s)},1),t.timeout=setTimeout(function(){t.called||!d?(t.called=!1,t.CSSAIsRunning=!1):(r.css(jQuery.CSS.sfx+"transition",""),d.apply(t),t.CSSAIsRunning=!1,"function"==typeof t.CSSqueue&&(t.CSSqueue(),t.CSSqueue=null))},l+u+10)}else{for(i in a)"transform"===i&&delete a[i],"filter"===i&&delete a[i],"transform-origin"===i&&delete a[i],"auto"===a[i]&&delete a[i],"x"===i&&(o=a[i],n="left",a[n]=o,delete a[i]),"y"===i&&(o=a[i],n="top",a[n]=o,delete a[i]),"-ms-transform"!==i&&"-ms-filter"!==i||delete a[i];r.delay(u).animate(a,l,d)}}})}},jQuery.fn.CSSAnimate=jQuery.CSS.animate,jQuery.normalizeCss=jQuery.CSS.normalizeCss,jQuery.fn.css3=function(r){return this.each(function(){var e=jQuery(this),t=jQuery.normalizeCss(r);e.css(t)})},function(n){n.simpleSlider={defaults:{initialval:0,maxval:100,orientation:"h",readonly:!1,callback:!1},events:{start:n.browser.mobile?"touchstart":"mousedown",end:n.browser.mobile?"touchend":"mouseup",move:n.browser.mobile?"touchmove":"mousemove"},init:function(o){return this.each(function(){var t=this,r=n(t);r.addClass("simpleSlider"),t.opt={},n.extend(t.opt,n.simpleSlider.defaults,o),n.extend(t.opt,r.data());var e="h"===t.opt.orientation?"horizontal":"vertical",e=n("<div/>").addClass("level").addClass(e);r.prepend(e),t.level=e,r.css({cursor:"default"}),"auto"==t.opt.maxval&&(t.opt.maxval=n(t).outerWidth()),r.updateSliderVal(),t.opt.readonly||(r.on(n.simpleSlider.events.start,function(e){n.browser.mobile&&(e=e.changedTouches[0]),t.canSlide=!0,r.updateSliderVal(e),"h"===t.opt.orientation?r.css({cursor:"col-resize"}):r.css({cursor:"row-resize"}),t.lastVal=t.val,n.browser.mobile||(e.preventDefault(),e.stopPropagation())}),n(document).on(n.simpleSlider.events.move,function(e){n.browser.mobile&&(e=e.changedTouches[0]),t.canSlide&&(n(document).css({cursor:"default"}),r.updateSliderVal(e),n.browser.mobile||(e.preventDefault(),e.stopPropagation()))}).on(n.simpleSlider.events.end,function(){n(document).css({cursor:"auto"}),t.canSlide=!1,r.css({cursor:"auto"})}))})},updateSliderVal:function(e){var t,r,o=this.get(0);o.opt&&(o.opt.initialval="number"==typeof o.opt.initialval?o.opt.initialval:o.opt.initialval(o),t=n(o).outerWidth(),r=n(o).outerHeight(),o.x="object"==typeof e?e.clientX+document.body.scrollLeft-this.offset().left:"number"==typeof e?e*t/o.opt.maxval:o.opt.initialval*t/o.opt.maxval,o.y="object"==typeof e?e.clientY+document.body.scrollTop-this.offset().top:"number"==typeof e?(o.opt.maxval-o.opt.initialval-e)*r/o.opt.maxval:o.opt.initialval*r/o.opt.maxval,o.y=this.outerHeight()-o.y,o.scaleX=o.x*o.opt.maxval/t,o.scaleY=o.y*o.opt.maxval/r,o.outOfRangeX=o.scaleX>o.opt.maxval?o.scaleX-o.opt.maxval:o.scaleX<0?o.scaleX:0,o.outOfRangeY=o.scaleY>o.opt.maxval?o.scaleY-o.opt.maxval:o.scaleY<0?o.scaleY:0,o.outOfRange="h"===o.opt.orientation?o.outOfRangeX:o.outOfRangeY,o.value=void 0!==e?"h"===o.opt.orientation?o.x>=this.outerWidth()?o.opt.maxval:o.x<=0?0:o.scaleX:o.y>=this.outerHeight()?o.opt.maxval:o.y<=0?0:o.scaleY:"h"===o.opt.orientation?o.scaleX:o.scaleY,"h"===o.opt.orientation?o.level.width(Math.floor(100*o.x/t)+"%"):o.level.height(Math.floor(100*o.y/r)),o.lastVal===o.value&&("h"===o.opt.orientation&&(o.x>=this.outerWidth()||o.x<=0)||"h"!==o.opt.orientation&&(o.y>=this.outerHeight()||o.y<=0))||("function"==typeof o.opt.callback&&o.opt.callback(o),o.lastVal=o.value))}},n.fn.simpleSlider=n.simpleSlider.init,n.fn.updateSliderVal=n.simpleSlider.updateSliderVal}(jQuery),function(t){t.mbCookie={set:function(e,t,r,o){"object"==typeof t&&(t=JSON.stringify(t)),o=o?"; domain="+o:"";var n=new Date,i="";0<r&&(n.setTime(n.getTime()+864e5*r),i="; expires="+n.toGMTString()),document.cookie=e+"="+t+i+"; path=/"+o},get:function(t){t+="=";for(var e=document.cookie.split(";"),r=0;r<e.length;r++){for(var o=e[r];" "==o.charAt(0);)o=o.substring(1,o.length);if(0==o.indexOf(t))try{return JSON.parse(o.substring(t.length,o.length))}catch(e){return o.substring(t.length,o.length)}}return null},remove:function(e){t.mbCookie.set(e,"",-1)}},t.mbStorage={set:function(e,t){"object"==typeof t&&(t=JSON.stringify(t)),localStorage.setItem(e,t)},get:function(t){if(!localStorage[t])return null;try{return JSON.parse(localStorage[t])}catch(e){return localStorage[t]}},remove:function(e){e?localStorage.removeItem(e):localStorage.clear()}}}(jQuery);